# JOIN
- 내부 JOIN
- 외부 JOIN(left, right)

> 비디오 가게에 비디오를 빌리러 갔는데
> 사장님이 장부를 작성한다.
> 장부에 비디오를 빌릴때 빌리는 사람
> 빌리는 사람이 없다면 비디오는 빌려질수가 없다.



*** 빌리는 사람 table ***
id(기본키) | 이름  | 나이 | 
1          | soon | 20   |

*** 장부 테이블 table *** 
비디오   | 사용자_id(외래키) | 가격 |

데이터의 모델링
> 정보를 시스템적으로 구축할때 사물적인 내용을 가지고 시선으로 바라보면서 모델을 설계한다.
> 현실에 있는 개념을 가지고 데이터베이스의 테이블을 설계를 해서 다이어그램으로 표현해서 아키텍처 설계를 한다.(ERD)
> 데이터를 추상화한 모델은 데이터의 형태를 이해하기 위해서 SQL로 작성하면 된다.
> 백엔드 개발자의 핵심


1. 작성하는 프로그램의 내용을 파악
쉽게 게시판
현실의 프로젝트 요구사항 파악 (어떤 어떤 테이블이 필요할거 같은데?)

2. 개념적 설계
> ERD 다이어그램 작성(필요한 필드명들 정리)
> ERD(Entity Relationship Diagram) 객체의 관계성을 다이그램으로 표현

3. 논리적 설계
> 상세한 타입 설계 속성들 정리

4. 데이터 베이스 구현.
> SQL 작성 구현


### 테이블하나하나가 엔티티
> 데이터로 표현 즉 정의가 가능한 사물이나 개념을 뜻
> 엔티티의 중요한 목적 타입 검사가 가장 중요하다. 즉 키와 값을 정의할때 타입을 잘 설계하는것이 중요하다.


> 장부 테이블에 데이터를 추가할때 사용자_id(외래키)이 값에 저장하는 값의 데이터가 빌리는 사람 table의 기본키가 있는지 확인하고
> 테이블에 데이터를 추가할수 있는 제약 조건

> join구문과 외래기 제약조건은 기능적으로 상관은 없지만 테이블의 설계 목적에 따라서 작성하기 위해서 제약조건을 걸고 사물적으로 데이터를 표현한뒤 join을 목적성에 맞게 사용하자.

> 기본키를 가지고 외래키를 관계성을 맺어서 식별자로 식별하는 경우
> 기본키가 포함되어 있는 여부에 따라서 연관성으로 부모의 삭제가 일어나면 자식의 테이블의 값도 삭제를 할수 있다.
> 일반 컬럼으로 외래키의 관계성을 맺어서 사용하는 경우 연관성으로 부모 삭제 시에도 자식 테이블의 데이터를 유지할수 있다.
> 용어로 식별자 관계, 비식별자 관계
1. 식별자 관계 : 기본키를 사용해서 외래키와 관계성을 맺는 경우 자식의 테이블에서 기본키로 설정한 외래키
2. 비식별자 관계 : 일반 컬럼을 사용해서 외래키와 관계성을 맺는 경우

### 식별자 관계
```sql
CREATE TABLE parent {
    parent_id INT PRIMARY KEY
}

CREATE TABLE child {
    child_id INT,
    parent_id INT,
    PRIMARY KEY (child_id, parent_id) ## 부모의 키를 가지고 자식의 기본키에 포함시킴
    // 자식은 부모의 기본키를 따라간다 즉 부모가 삭제되면 자식 테이블의 값도 삭제된다.
    FOREIGN KEY (parent_id) REFERENCES parent (parent_id)
    // FOREIGN KEY 외래키
}
```

### 비식별자 관계
```sql
CREATE TABLE parent {
    parent_id INT PRIMARY KEY
}

CREATE TABLE child {
    child_id INT PRIMARY KEY, ## 부모의 키를 자식의 기본키로 포함하지 않는다.
    // 부모의 테이블의 값이 제거되어도 자식 테이블의 값이 남아있다.
    parent_id INT,
    FOREIGN KEY (parent_id) REFERENCES parent (parent_id)
}
```

> ORM 모델을 사용하는경우 외래키 제약 조건이 없으면 join구문을 사용할수 없도록 조건문 처리를 해놓았다.


> 장부 테이블에 값이 추가되기 위해서는 빌리는 사람의 테이블에 데이터가 있어야한다.
> 제약 조건을 추가한다. 외래키

제약 조건은 두가지
1. 기본키 : 식별자로 사용되고 index를 할 수 있는 키를 설정(조회가 번번히 많이 일어나는 테이블의 경우에는 기본키로 인덱싱한다.)
2. 외래키 : 다른 테이블의 기본키를 참조


1. 테이블의 연결 관계를 맺고 같은 값을 가진 컬럼이 존재한다.

### 설계가 된 이후에
JOIN
> 왜 설계가 된 이후에 사용을 해야하느냐 
> 기능적으로 문제는 없지만 개념적으로 관계성이 없는 데이터를 조회할 필요는 없기 때문에

1. JOIN의 개념 : 관계성을 가지고 있는 테이블의 데이터를 조회하는 경우에 사용하는 쿼리문 특정 조건에 맞는 데이터를 조회할때 사용/
2. 테이블의 관계성이 설정 : 2개 이상의 테이블의 관계성을 정의해서 값을 조회하거나 혹은 수정 삭제에도 사용할수 있다.

### JOIN의 특징
1. 다중 테이블 조회 : 2개 이상의 테이블의 값을 조회할수 있다.
```sql
select * from user where id=1;

// 조회하면서 두 테이블의 값을 수정
update user JOIN board ON user.id = board.user_id SET user.name = "soon" where board.user_name = "soon";
```
2. 별칭도 사용 가능 : JOIN을 할때 테이블의 필드가 겹치거나 하는 현상에서 별칭을 사용해서 가독성을 높일 수 있다.

### 테이블 설계
> 요구사항 학생이 정보를 입력해서 가입을 하고 수강신청으로 과목을 정해서 신청할수 있는 페이지를 만들어주세요
> 학생은 회원가입을 할때 이름을 입력하고
> 수강신청을 할때는 해당 학생이 수강하고싶은 과목을 입력 받아주세요. 과정명이랑 과목을 입력 받아주세요

> 학생 테이블이 있고
> 학생이 수강하는 강의의 이름

> 학생 테이블
> 수강 테이블

학생 테이블은 id 식별자를 하나 만들고 이름을 하나 만들어야할거같아 필드로
수강 테이블은 과정명 과목 학생의 아이디가 하나 매핑을 위해서 필요할거 같아.

학생 테이블의 필드 : id INT PRIMARY KEY AUTO_INCREMENT, 이름 VARCHAR(10)
수강 테이블의 필드 : class VARCHAR(20), study VARCHAR(20), 학생 ID INT

관계성의 기호 : 부모의 테이블에 관계성을 가지고 있는 키에는 || 표현 기호가 붙는다 부모의 테이블에 필수 기호

<img src="./ERD 관계 표현 기호.png">

```sql
CREATE TABLE student (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(10)
)

CREATE TABLE student_class (
    class VARCHAR(20),
    study VARCHAR(20),
    student_id INT
)

## 학생 회원가입
INSERT INTO student VALUES("soon");

## 수강 신청
INSERT INTO student_class VALUES("game", "game1", 1);

### LEFT JOIN
SELECT * FROM [테이블1 명] LEFT JOIN [테이블2 명] ON [테이블1 명].id = [테이블2 명].student_id

SELECT * FROM student LEFT JOIN student_class ON student.id = student_class.student_id;

### JOIN의 종류
INNER JOIN : 공통된 내용 즉 공통된 데이터만 조회를 하는 것.
LEFT JOIN : 어휘적으로 왼쪽에 작성한 테이블의 데이터를 유지하고 조건이 맞는 오른쪽의 테이블의 내용을 조회
RIGHT JOIN : 어휘적으로 오른쪽에 작성한 테이블의 데이터를 유지하고 조건이 맞는 왼쪽의 테이블의 내용을 조회
FULL JOIN : 두 테이블에 있는 모든 내용을 조회
CROSS JOIN : 모든 가능한 조합의 결과를 조회(카타시안 곱)
SELF JOIN : 같은 테이블에서 댓글의 대댓글 대대대댓글처럼 댑스가 많이 증가하는 형태의 테이블을 작성할 수 있다. 즉 테이블 한개에서 관계성을 데이터의 관계성을 표현.

### 워크벤치에서 다이어그램 그려서 관계성 확인해보기
```
