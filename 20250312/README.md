# 암호화, 환경변수 설정

> 관계형 데이터베이스, 제약조건, 인덱싱의 개념

> 비밀번호를 저장할때 원본값을 저장하면 노출될 가능성이 있어서 보안상 위험 
> id : soon, pw : admin123 
> 요즘 사이트에 회원가입을 하면 로그인할때 비밀번호를 잊어버렸다.
> 비밀번호 찾기를 하면 본인인증을 하고 비밀번호를 다시 변경하라고 한다.
> 원본의 비밀번호를 알려주지 않는다. 원본 비밀번호와 값을 입력한 값과 일치한지

### 암호화
> 암호화는 데이터를 안전하게 관리하기 위해서 특정한 알고리즘을 사용해서 원래의 값을 숨기는 과정

> 사용하는 데이터를 복원하기 위해서 키값을 사용한다. 

### 해시 함수
> 해시 함수는 전달한 데이터의 크기를 지정하고 고유한 값으로 변환하는 알고리즘

> 안녕 -> 고정된 해시 문자열로 변환

### sha256
> sha256 보안적으로 이슈가 가장 적었던 알고리즘
> 암호학적 해시 함수
> 256비트의 (32바이트) 고정된 길이의 해시값을 만드는 함수
> 원본의 값을 변환한 값이 항상 동일하다.
> 주로 데이터의 검증의 암호화의 알고리즘으로 사용되고, 비밀번호
> 디지털 전자 서명, 블록체인 등 사용이 된다.
> sha256을 사용하는 이유는 보안성, 무결성 검증

### sha256 암호화
```js
const crypto = require('crypto');
const upw = "admin123";

// 해시화 : 알고리즘을 통해서 데이터의 고정된 크기의 고유한 값으로 바꿔주는 행위. 16진수의 값으로 변환 고정된 크기의 문자열.

// 알고리즘은 sha256 알고리즘 사용
// 데이터를 256 비트의 고정 크기 값으로 변환해주는 알고리즘
// 원본데이터의 길이의 상관 없이 고정된 크기의 해시 값으로 변경을 해준다.

// createHash 메서드의 매개변수로 사용할 해시 함수 알고리즘 이름
const hash = crypto.createHash("sha256");
// hash 반환된 객체의 메서드를 사용해서 문자열 해시화
// update : 문자열을 해시화
const hashing = hash.update(upw);

console.log(hashing);
/*
    Hash {
    _options: undefined,
    [Symbol(kHandle)]: Hash {},
    [Symbol(kState)]: { [Symbol(kFinalized)]: false }
    }
 */

// digest 해시 문자열 반환 
// 64 자리(고정)의 크기의 문자열 16진수로 표현된
const hashString = hashing.digest('hex');

console.log(hashString); //240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9

// 솔트의 값을 사용해서 예측이 불가능한 데이터를 만들어 줘야 한다.
```

### salt(솔트)
> 해시 함수의 값은 값을 입력 받으면 동일한 해시 문자열을 생성하기 때문에 보안적인 문제가 발생할 수 있다. 
> 비밀번호를 쉽게 유추할 수 없도록 솔트의 값을 추가해서 보안성을 좋게 만든다.

### 키 스트레칭 기법
> salt만으로 해커의 공격을 차단하기는 힘들기 때문에 귀찮게 하고 보완하기 위해서 키스트레칭 기법을 사용한다. 
> 해시 함수를 여러번 연산 반복해서 시간을 지연시킨다.
> 솔트의 반복 연산을 오래걸리게 

### 비밀번호 암호화해서 회원가입 만들어보기

### Mysql에 회원 정보 저장

```js
const connectPool = mysql.createPool({
    user : "zzeen",
    password: "issue0012",
    database : "project",
    multipleStatements : true,
    host : "localhost",
    port : 3306
})
// mysql의 옵션을 전달할 때 코드가 노출될 위험성이 있기때문에
// 우리의 컴퓨터의 환경변수를 사용해서 안전하게 사용하는 방법이 있다.
// 환경 변수를 프로그램 실행시킬때 환경변수로 저장하고 프로그램에서 환경변수에 접근해서 사용하는 방식

// .env : 환경변수를 저장하는 text 파일
// 환경변수로 추가할 내용을 작성할 text 민감한 정보들 API KEY 등등
// 서버에 운영을 하는 경우 파일로 .env를 파일로 업로드 하면 안되고, 서버측에 ssh 안전하게 접근해서 
// 접속해서 생성을 따로 해줘야 한다.



// .env의 문법
// 환경변수의 이름(키) = 환경변수의 값(값)
DATABASE_USER = zzeen;  
DATABASE_PASSWORD = issue0012;
DATABASE_HOST = localhost;
DATABASE_PORT = 3306;
```
## 오늘의 실습
> 회원가입할때 닉네임 추가
> 정규식 사용해서 프론트에서는 아이디는 8자 까지 영어 대소문자 가능, 특수문자 x, 숫자시작x
> 비밀번호 특수문자 1이상 포함 대문자 1개 이상 포함 자리는 최소 8자리에서 14자리까지
> 닉네임은 중복 가능, 아이디는 불가능
> 닉네임 변경과 회원 탈퇴